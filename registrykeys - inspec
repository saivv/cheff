# encoding: utf-8
# copyright: 2015, The Authors

title 'sample section'

#using controls SMB
control 'test-00001' do
  impact 0.6
  describe registry_key('HKLM\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters') do
    its('SMB1') { should == 0 }  
    end
end
## Microsoft SQL Server 2014 and 2016 PowerShell Execution Policy
control 'test-00002' do
  impact 0.6
  describe registry_key('HKLM\SOFTWARE\Microsoft\PowerShell\1\ShellIds\Microsoft.SqlServer.Management.PowerShell.sqlps120') do
    its('ExecutionPolicy') { should == 'undefined' }  
    end
end
control 'test-00003' do
  impact 0.6
  describe registry_key('HKLM\SOFTWARE\Microsoft\PowerShell\1\ShellIds\Microsoft.SqlServer.Management.PowerShell.sqlps130') do
    its('ExecutionPolicy') { should == 'undefined' }  
    end
end
# Disable HyperV Integration Service Time Provider
control 'test-00004' do
  impact 0.6
  describe registry_key('HKLM\SYSTEM\CurrentControlSet\Services\W32Time\TimeProviders\VMICTimeProvider') do
    its('Enabled') { should == 0 }  
    end
end
## Meltdown/Spectre security issue
control 'test-00005' do
  impact 0.6
  describe registry_key('HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management') do
    its('FeatureSettingsOverride') { should == 0 }  
    end
end
control 'test-00006' do
  impact 0.6
  describe registry_key('HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management') do
    its('FeatureSettingsOverrideMask') { should == 3 }  
    end
end
control 'test-00007' do
  impact 0.6
  describe registry_key('HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Virtualization') do
    its('MinVmVersionForCpuBasedMitigations') { should == '1.0' }  
    end
end
control 'test-00008' do
  impact 0.6
  describe registry_key('HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\QualityCompat') do
    its('cadca5fe-87d3-4b96-b7fb-a231484277cc') { should == 0 }  
    end
end
## Internet Explorer, MSOffice and Restricted Admin Registry Keys added
control 'test-00009' do
  impact 0.6
  describe registry_key('HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Lsa') do
    its('DIsableRestrictedAdmin') { should == 0 }  
    end  
end
control 'test-00010' do
  impact 0.6
  describe registry_key('HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SecurityProviders\WDigest') do
    it { should have_property_value('UseLogonCredential', :dword, 1) } 
    end 
end
control 'test-00011' do
  impact 0.6
  describe registry_key('HKEY_CURRENT_USER\Software\Microsoft\Office\2121\Excel\Security') do
   it { should have_property_value('WorkbookLinkWarnings', :dword, 2) } 
    end
end
control 'test-00012' do
  impact 0.6
  describe registry_key('HKEY_CURRENT_USER\Software\Microsoft\Office\2121\WordOptions') do
    it { should have_property_value('DontUpdateLinks', :dword, 1) }  
    end
end
control 'test-00013' do
  impact 0.6
  describe registry_key('HKEY_CURRENT_USER\Software\Microsoft\Office\2121\WordOptions\WordMail') do
    it { should have_property_value('DontUpdateLinks', :dword, 1) }   
    end
end
control 'test-00014' do
  impact 0.6
  describe registry_key('HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX') do
    it { should have_property_value('iexplore.exe', :dword, 1) } 
    end
end
control 'test-00015' do
  impact 0.6
  describe registry_key('HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX') do
    it { should have_property_value('iexplore.exe', :dword, 1) }
      end
end
control 'test-00016' do
  impact 0.6
  describe registry_key('HKLM\SOFTWARE\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_ALLOW_USER32_EXCEPTION_HANDLER_HARDENING') do
    it { should have_property_value('iexplore.exe', :dword, 1) } 
    end
end
control 'test-00017' do
  impact 0.6
  describe registry_key('HKLM\SOFTWARE\WOW6432Node\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_ALLOW_USER32_EXCEPTION_HANDLER_HARDENING') do
    it { should have_property_value('iexplore.exe', :dword, 1) } 
    end
end


